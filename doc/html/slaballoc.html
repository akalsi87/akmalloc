<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>akmalloc: Slab allocator</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname"><tt>akmalloc</tt>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Slab allocator </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Slabs are a concept borrowed from <a href="https://www.usenix.org/legacy/publications/library/proceedings/bos94/full_papers/bonwick.a">Jeff Bonwick's UseNIX paper </a> and adapted as a general implementation scheme.</p>
<p>The major departures from the scheme presented in Jeff's paper is that we don't keep the client-specified object APIs because we are using slabs to implement the plain old <code>libc</code> memory allocation routines which do not have this flexibility.</p>
<p>Nevertheless, slabs prove to be efficient and compact for dealing with memory.</p>
<p>Slabs are all page sized, and allocate a fixed size. They have a bit map at the head with some links to forward and back slabs. The slab bit map knows which indexes of fixed size entries are free and which are allocated. Allocating a new object is as simple as finding the first index of the unused bit in the bit map and flipping it. Freeing is also fast, because we mask out the pointer to get the page and in constant time we know which slab the pointer came from and we update the bit map.</p>
<p>Instead of using free lists which require more memory hops, we favour a bit mask at the head.</p>
<p>Slabs are held in chains with a root. This root has the meta data about the slab, like what fixed size it is allocating, how often do we return slab pages to the OS etc.</p>
<p>Slab roots have three lists of slabs</p>
<ol type="1">
<li><em>Partial</em>: List of partially filled slabs.</li>
<li><em>Full</em>: List of completely full slabs.</li>
<li><em>Empty</em>: List of completely empty slabs.</li>
</ol>
<p>This separation exists so that a slab root can get to an allocation in constant time by only checking the partial bins. As they fill up, the slab is moved to the full bin. If something in a full bin is freed, it is moved to the partial bin, and when all entries in a slab are free, it is moved to the empty bin.</p>
<p>When there are more than a user-settable number of empty slabs, the slab allocator will free another user-settable number of them. The default is for both number to be equal, which means every so often, a slab allocator will return all its free pages to the OS.</p>
<p>This allocator can be made thread safe upon request. </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
<!-- Generated on Sun Jul 17 2016 20:24:51 for akmalloc by &#160;<a href="http://www.doxygen.org/index.html"> -->
<!-- <img class="footer" src="doxygen.png" alt="doxygen"/> -->
</a> 1.8.8
</small></address>
</body>
</html>
