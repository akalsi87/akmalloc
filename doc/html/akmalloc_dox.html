<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>akmalloc: akmalloc</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname"><tt>akmalloc</tt>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">akmalloc </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><code>akmalloc</code> is a composite allocator, combining slabs and coalescing allocators.</p>
<p>It uses a static <code>ak_malloc_state</code>.</p>
<p>All the exported APIs are based on <code>ak_malloc_state</code>.</p>
<p>It uses an array of slabs of sizes from 8B to 256B, an array of coalescing allocators ranging in size from 768B to 1MB and directly uses OS calls beyond that size.</p>
<p>It handles multi threading by having a lock per slab or coalescing allocator, or OS calls. Multiple threads that allocate or free a size in a different size category do not contend with each other.</p>
<p>By default shared and static libraries have a thread safe malloc and free.</p>
<p>Every allocation has a 8B header which contains a distinct bit mask allowing the allocator to classify it.</p>
<div class="fragment"><div class="line">---0      Coalescing allocator with fourth bit unset always</div>
<div class="line">0101      Slab allocator</div>
<div class="line">1001      mmap()</div>
</div><!-- fragment --><dl class="section see"><dt>See also</dt><dd><a class="el" href="malloc_8h.html">akmalloc/malloc.h</a> </dd>
<dd>
<a class="el" href="malloc_8c.html">akmalloc/malloc.c</a></dd></dl>
<h1><a class="anchor" id="customMalloc"></a>
Customization</h1>
<p><code>akmalloc</code> can be built as a shared library, static library, or included directly as part of your source code.</p>
<h3>Include only </h3>
<p>To include this akmalloc directly, simply define <code>AKMALLOC_INCLUDE_ONLY</code> before including the <code><a class="el" href="malloc_8h.html">malloc.h</a></code> file.</p>
<h3>Static library </h3>
<p>To build a static library, define <code>AKMALLOC_LINK_STATIC</code> and you may have to change <code>AKMALLOC_EXPORT</code>.</p>
<h3>Shared library </h3>
<p>To build a shared library, define <code>AKMALLOC_BUILD</code> when building the library, and set <code>AKMALLOC_EXPORT</code> to be the right visibility symbol for your compiler/system i.e., <code>__declspec(dllexport)</code> on Windows/MSVC and <code>__attribute__((__visibility__("default")))</code> on Linux/Mac.</p>
<p>When including the header for the shared library, ensure <code>AKMALLOC_EXPORT</code> is defined correctly for the import (<code>__declspec(dllimport)</code> on Windows/MSVC and <code></code> on Linux/Mac).</p>
<h3>Customizing <code>akmalloc</code> </h3>
<p>The following defines are available for use while building (or including if your build is only directly including the header files). They are marked as controlling one or more options.</p>
<p>It is better to define these before including any <code>akmalloc</code> header files.</p>
<div class="fragment"><div class="line"><span class="comment">// controls whether the symbols available are malloc/free etc. or ak_malloc/ak_free...</span></div>
<div class="line"><span class="comment">// works for ak_malloc</span></div>
<div class="line"><span class="preprocessor">#define AKMALLOC_USE_PREFIX // [0 | 1]</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// controls the symbol visibility of APIs, default chosen based on build type</span></div>
<div class="line"><span class="comment">// works for all exported APIs</span></div>
<div class="line"><span class="comment">// if building a shared library, you probably want something like &#39;__declspec(dllexport)&#39;</span></div>
<div class="line"><span class="comment">// on Windows/MSVC and &#39;__attribute__((__visibility__(&quot;default&quot;)))&#39; on Linux/Mac.</span></div>
<div class="line"><span class="preprocessor">#define AKMALLOC_EXPORT // choose based on build type, default: extern</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// controls the assert macro to use</span></div>
<div class="line"><span class="comment">// works with all APIs when built in debug mode (NDEBUG is not defined)</span></div>
<div class="line"><span class="preprocessor">#define AKMALLOC_ASSERT_IMPL // default: custom assert macro</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// whether to use locks for malloc()/free()</span></div>
<div class="line"><span class="comment">// works for ak_malloc</span></div>
<div class="line"><span class="preprocessor">#define AKMALLOC_USE_LOCKS [0 | 1] // defaults to 1 for libraries</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// whether to use locks for ak_malloc_from_state() variety of APIs</span></div>
<div class="line"><span class="comment">// including malloc.h directly will set this based on AKMALLOC_USE_LOCKS</span></div>
<div class="line"><span class="comment">// works for ak_malloc_state</span></div>
<div class="line"><span class="preprocessor">#define AK_MALLOCSTATE_USE_LOCKS // defined or undefined, default is undefined</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// whether to always align allocations at 16 byte boundaries, slabs can do 8</span></div>
<div class="line"><span class="comment">// works for ak_malloc_state and ak_malloc</span></div>
<div class="line"><span class="preprocessor">#define AK_MIN_SLAB_ALIGN_16 // defined or undefined, default is undefined</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// number of empty pages after which to free some</span></div>
<div class="line"><span class="comment">// works for ak_slab, ak_malloc_state and ak_malloc</span></div>
<div class="line"><span class="preprocessor">#define AK_SLAB_RELEASE_RATE // default: 127</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// number of empty pages to free after a release is reached</span></div>
<div class="line"><span class="comment">// works for ak_slab, ak_malloc_state and ak_malloc</span></div>
<div class="line"><span class="preprocessor">#define AK_SLAB_MAX_PAGES_TO_FREE // default: AK_SLAB_RELEASE_RATE</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// multiples of this size are used to obtain memory from the OS for coalescing allocators</span></div>
<div class="line"><span class="comment">// works for ak_ca_root, ak_malloc_state and ak_malloc</span></div>
<div class="line"><span class="preprocessor">#define AK_COALESCE_SEGMENT_GRANULARITY // default is 256KB for ak_malloc and ak_malloc_state</span></div>
<div class="line">                                        <span class="comment">// deafult is 64KB for ak_ca_root</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// number of empty segments after which to free them</span></div>
<div class="line"><span class="comment">// works for ak_ca_root, ak_malloc_state and ak_malloc</span></div>
<div class="line"><span class="preprocessor">#define AKMALLOC_COALESCING_ALLOC_RELEASE_RATE // default: 24</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// number of segments to free after a release is required</span></div>
<div class="line"><span class="comment">// works for ak_ca_root, ak_malloc_state and ak_malloc</span></div>
<div class="line"><span class="preprocessor">#define AKMALLOC_COALESCING_ALLOC_MAX_PAGES_TO_FREE // default: AKMALLOC_COALESCING_ALLOC_RELEASE_RATE</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// at what size to resort to using mmap() like system calls</span></div>
<div class="line"><span class="comment">// works for ak_malloc_state and ak_malloc</span></div>
<div class="line"><span class="preprocessor">#define MMAP_SIZE // default is system determined, e.g. 65536</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// customize memory map calls</span></div>
<div class="line"><span class="comment">// works for all APIs</span></div>
<div class="line"><span class="comment">// signature for map:   void* (*map)(size_t s);              // return 0 on failure</span></div>
<div class="line"><span class="comment">// signature for unmap: void  (*unmap)(void* mem, size_t s);</span></div>
<div class="line"><span class="preprocessor">#define AKMALLOC_MMAP   // default: system dependent</span></div>
<div class="line"><span class="preprocessor">#define AKMALLOC_MUNMAP // default: system dependent</span></div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
<!-- Generated on Sun Jul 17 2016 20:24:51 for akmalloc by &#160;<a href="http://www.doxygen.org/index.html"> -->
<!-- <img class="footer" src="doxygen.png" alt="doxygen"/> -->
</a> 1.8.8
</small></address>
</body>
</html>
